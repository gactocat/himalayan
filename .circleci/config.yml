version: 2.1
orbs:
  gradle: circleci/gradle@1.0.11
workflows:
  checkout-build-test:
    jobs:
      - gradle/test
  checkout-run_task:
    jobs:
      - gradle/run:
          command: build -x test

#version: 2
#jobs:
#  build:
#    docker:
#      - image: circleci/openjdk:8-jdk
#    working_directory: ~/repo
#    environment:
#      JVM_OPTS: -Xmx3200m
#      TERM: dumb
#    steps:
#      - checkout
#      - restore_cache:
#          keys:
#            - v1-dependencies-{{ checksum "build.gradle.kts" }}
#            - v1-dependencies-
#      - run: gradle dependencies
#      - save_cache:
#          paths:
#            - ~/.gradle
#          key: v1-dependencies-{{ checksum "build.gradle.kts" }}
#      - run: gradle test
#      - run:
#          name: Save test results
#          command: |
#            mkdir -p ~/test-results/junit/
#            find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} ~/test-results/junit/ \;
#          when: always
#      - store_test_results:
#          path: ~/test-results
#      - store_artifacts:
#          path: ~/test-results/junit
